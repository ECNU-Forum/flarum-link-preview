(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const n=flarum.core.compat["forum/app"];var r=e.n(n);const a=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/components/CommentPost"];var o=e.n(i);r().initializers.add("datlechin/flarum-link-preview",(function(){(0,a.extend)(o().prototype,"oncreate",(function(){this.element.querySelectorAll(".Post-body a[rel]").forEach((function(e){var t=e.getAttribute("href");if(!(e.classList.contains("PostMention")&&e.classList.contains("UserMention")||t!==e.textContent)){var n=document.createElement("div");n.classList.add("LinkPreview"),e.parentNode.insertBefore(n,e),n.appendChild(e);var a=document.createElement("div");a.classList.add("LinkPreview-image"),n.appendChild(a);var i=document.createElement("img");a.appendChild(i);var o=document.createElement("div");o.classList.add("LinkPreview-main"),n.appendChild(o);var d=document.createElement("div");d.classList.add("LinkPreview-title"),o.appendChild(d);var l=document.createElement("a");l.target="_blank",d.appendChild(l);var s=document.createElement("div");s.classList.add("LinkPreview-description"),o.appendChild(s);var c=document.createElement("div");c.classList.add("LinkPreview-domain"),o.appendChild(c);var m=document.createElement("a");m.href=t,m.target="_blank";var p=t.split("/")[2].replace("www.",""),u=t.split("/")[0]+"//"+p,v=document.createElement("img");v.setAttribute("src","https://www.google.com/s2/favicons?sz=64&domain_url="+u),c.appendChild(v),m.textContent=p,c.appendChild(m),m.href=u;var f=document.createElement("i");f.classList.add("fa","fa-spinner","fa-spin"),a.appendChild(f),e.remove(),r().request({url:r().forum.attribute("apiUrl")+"/datlechin-link-preview?url="+encodeURIComponent(t),method:"GET"}).then((function(e){f.remove();var n=e.image?e.image:"https://www.google.com/s2/favicons?sz=64&domain_url="+u;i.setAttribute("src",n),l.href=e.url?e.url:t,l.textContent=e.title?e.title:p,s.textContent=e.description?e.description:"",m.textContent=e.site_name?e.site_name:p,e.error&&(i.setAttribute("src","https://www.google.com/s2/favicons?sz=64&domain_url="+u),l.textContent=r().translator.trans("datlechin-link-preview.forum.site_cannot_be_reached"),l.removeAttribute("href"),s.textContent="",m.removeAttribute("href"))}))}}))}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map